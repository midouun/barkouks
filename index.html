<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù‡Ø§ÙŠ Ø¯Ø§ÙŠ ØªÙ„ÙŠØ¬Ø±Ø§Ù… ğŸšœ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Changa:wght@400;700&display=swap');

        :root {
            --grass-light: #8DCF56;
            --grass-dark: #7DBF46;
            --wood-light: #E4A656;
            --wood-dark: #A05E23;
            --sky: #AEE6F8;
        }

        body {
            font-family: 'Changa', sans-serif;
            background-color: var(--sky);
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        /* --- Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù„Ù… (Isometric World) --- */
        .world-container {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: 
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.2) 0%, transparent 60%),
                linear-gradient(to bottom, #AEE6F8 0%, #8DCF56 40%);
        }

        .iso-grid {
            transform: rotateX(60deg) rotateZ(-45deg);
            transform-style: preserve-3d;
            display: grid;
            grid-template-columns: repeat(6, 60px);
            grid-template-rows: repeat(6, 60px);
            gap: 4px;
            padding: 100px;
        }

        /* --- Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª (Tiles) --- */
        .tile {
            width: 60px;
            height: 60px;
            background-color: var(--grass-light);
            border: 4px solid var(--grass-dark);
            border-radius: 4px;
            position: relative;
            transition: transform 0.1s;
            cursor: pointer;
            box-shadow: -4px 4px 0px rgba(0,0,0,0.2); /* Ø¹Ù…Ù‚ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        .tile:active { transform: translate(-2px, 2px); box-shadow: -2px 2px 0px rgba(0,0,0,0.2); }
        
        /* Ù…Ø¸Ù‡Ø± Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ù…Ø­Ø±ÙˆØ«Ø© */
        .tile.farmland { background-color: #6D4C41; border-color: #4E342E; }
        
        /* Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ ÙˆØ§Ù„Ù…Ø¨Ø§Ù†ÙŠ (Sprites) */
        .sprite {
            position: absolute;
            top: -40px; left: -10px;
            width: 80px; height: 80px;
            pointer-events: none;
            transform: rotateZ(45deg) rotateX(-60deg); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù…Ù†Ø¸ÙˆØ± Ù„Ù„ØµÙˆØ±Ø© */
            display: flex;
            justify-content: center;
            align-items: flex-end;
            font-size: 40px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
            transition: transform 0.3s;
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù†Ù…Ùˆ */
        .growing .sprite { transform: rotateZ(45deg) rotateX(-60deg) scale(0.5); opacity: 0.8; }
        .ready .sprite { animation: bounce 1s infinite; cursor: grab; }

        @keyframes bounce {
            0%, 100% { transform: rotateZ(45deg) rotateX(-60deg) translateY(0); }
            50% { transform: rotateZ(45deg) rotateX(-60deg) translateY(-10px); }
        }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Wood UI) --- */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header-wood {
            pointer-events: auto;
            background: url('https://www.transparenttextures.com/patterns/wood-pattern.png'), linear-gradient(to bottom, #E4A656, #A05E23);
            border-bottom: 4px solid #5D4037;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: white;
            text-shadow: 1px 1px 2px #3E2723;
        }
        
        .xp-bar-container {
            width: 100px; height: 10px; background: #333; border-radius: 5px; overflow: hidden; margin-top: 5px;
            border: 1px solid white;
        }
        .xp-fill { height: 100%; background: #00E676; width: 0%; transition: width 0.5s; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .action-dock {
            pointer-events: auto;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
        }

        .tool-btn {
            width: 70px; height: 70px;
            background: radial-gradient(circle, #fff, #f0f0f0);
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            display: flex; justify-content: center; align-items: center;
            font-size: 32px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }
        .tool-btn.active { transform: scale(1.1) translateY(-10px); border-color: #FFD700; background: #FFF9C4; }
        .badge { position: absolute; top: 0; right: 0; background: red; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: bold; }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }
        
        .wood-panel {
            background: url('https://www.transparenttextures.com/patterns/wood-pattern.png'), #D7CCC8;
            border: 6px solid #8D6E63;
            border-radius: 20px;
            padding: 20px;
            width: 85%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }
        .wood-panel h2 { color: #3E2723; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
        .order-card {
            background: #FFF3E0; border: 2px dashed #FFB74D; border-radius: 10px;
            padding: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
        }

        /* Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ */
        .close-btn {
            position: absolute; top: -15px; right: -15px;
            width: 35px; height: 35px; background: #e53935; color: white;
            border-radius: 50%; border: 3px solid white; font-weight: bold;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø¹Ø§Ø¦Ù…Ø© */
        .floater {
            position: absolute; font-weight: bold; font-size: 18px; color: yellow;
            text-shadow: 0 2px 4px black; animation: floatUp 1s forwards; pointer-events: none; z-index: 200;
        }
        @keyframes floatUp { to { transform: translateY(-80px); opacity: 0; } }

    </style>
</head>
<body>

    <div class="world-container" id="world">
        <div class="iso-grid" id="grid">
            </div>
    </div>

    <div class="ui-layer">
        <div class="header-wood">
            <div style="display:flex; align-items:center; gap:10px;">
                <div style="background:#3E2723; border:2px solid #A1887F; width:45px; height:45px; border-radius:10px; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:20px;">
                    <span id="level">1</span>
                </div>
                <div>
                    <div id="u_name" style="font-weight:bold;">Ù…Ø²Ø§Ø±Ø¹</div>
                    <div class="xp-bar-container"><div class="xp-fill" id="xp-bar"></div></div>
                </div>
            </div>
            
            <div style="text-align:left;">
                <div style="background:#FFF8E1; color:#3E2723; padding:5px 10px; border-radius:20px; font-weight:bold; box-shadow:0 3px 0 #CCC;">
                    ğŸ’° <span id="coins">100</span>
                </div>
                <div style="background:#E0F7FA; color:#006064; padding:5px 10px; border-radius:20px; font-weight:bold; margin-top:5px; box-shadow:0 3px 0 #B2EBF2; font-size:12px;">
                    ğŸ’ <span id="gems">5</span>
                </div>
            </div>
        </div>

        <div class="action-dock">
            <div class="tool-btn" id="btn-shop" onclick="UI.openModal('shop')">
                ğŸª
                <span style="font-size:10px; position:absolute; bottom:5px;">Ø§Ù„Ù…ØªØ¬Ø±</span>
            </div>
            <div class="tool-btn" id="btn-silo" onclick="UI.openModal('silo')">
                ğŸ›–
                <span class="badge" id="silo-count">0</span>
                <span style="font-size:10px; position:absolute; bottom:5px;">Ø§Ù„ØµÙˆÙ…Ø¹Ø©</span>
            </div>
            <div class="tool-btn" id="btn-barn" onclick="UI.openModal('barn')">
                ğŸ˜ï¸
                <span class="badge" id="barn-count">0</span>
                <span style="font-size:10px; position:absolute; bottom:5px;">Ø§Ù„Ù…Ø®Ø²Ù†</span>
            </div>
            <div class="tool-btn" id="btn-truck" onclick="UI.openModal('orders')">
                ğŸšš
                <span class="badge">!</span>
                <span style="font-size:10px; position:absolute; bottom:5px;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-silo">
        <div class="wood-panel">
            <div class="close-btn" onclick="UI.closeAll()">X</div>
            <h2>ğŸŒ± ØµÙˆÙ…Ø¹Ø© Ø§Ù„Ø¨Ø°ÙˆØ±</h2>
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;" id="silo-grid"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-barn">
        <div class="wood-panel">
            <div class="close-btn" onclick="UI.closeAll()">X</div>
            <h2>ğŸ¥– Ø§Ù„Ù…Ø®Ø²Ù†</h2>
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;" id="barn-grid"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-orders">
        <div class="wood-panel">
            <div class="close-btn" onclick="UI.closeAll()">X</div>
            <h2>ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±</h2>
            <div id="orders-list"></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-shop">
        <div class="wood-panel">
            <div class="close-btn" onclick="UI.closeAll()">X</div>
            <h2>ğŸ—ï¸ Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹Ø©</h2>
            <div class="order-card" onclick="Game.buyPlot()">
                <div style="font-size:30px;">ğŸŸ«</div>
                <div>Ø£Ø±Ø¶ Ø²Ø±Ø§Ø¹ÙŠØ©<br><small>50 Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©</small></div>
            </div>
            <div class="order-card" onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ù…Ø®Ø¨Ø²')">
                <div style="font-size:30px;">ğŸ</div>
                <div>Ø§Ù„Ù…Ø®Ø¨Ø²<br><small>200 Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©</small></div>
            </div>
            
             <div style="margin-top:20px; border-top:2px dashed #8D6E63; padding-top:10px;">
                <p>Ø§Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ</p>
                <div id="ton-connect-btn"></div>
             </div>
        </div>
    </div>

    <div id="current-tool-display" style="position:absolute; bottom:120px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); color:white; padding:5px 15px; border-radius:20px; pointer-events:none; display:none;">
        Ø§Ù„Ø£Ø¯Ø§Ø©: <span id="tool-name">ÙŠØ¯</span>
    </div>

    <script>
        // === 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
        const tg = window.Telegram.WebApp;
        tg.expand();

        const CONFIG = {
            crops: {
                'wheat': { name: 'Ù‚Ù…Ø­', icon: 'ğŸŒ¾', time: 3000, xp: 2, sell: 5 },
                'corn': { name: 'Ø°Ø±Ø©', icon: 'ğŸŒ½', time: 6000, xp: 4, sell: 12 },
                'carrot': { name: 'Ø¬Ø²Ø±', icon: 'ğŸ¥•', time: 10000, xp: 6, sell: 18 }
            },
            products: {
                'bread': { name: 'Ø®Ø¨Ø²', icon: 'ğŸ', req: {wheat: 3}, time: 10000, sell: 30 },
                'egg': { name: 'Ø¨ÙŠØ¶', icon: 'ğŸ¥š', req: {}, time: 5000, sell: 10 }
            }
        };

        // === 2. Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ===
        let state = {
            coins: 100,
            gems: 5,
            level: 1,
            xp: 0,
            maxXp: 50,
            inventory: {
                'wheat': 5, // Ø¨Ø°ÙˆØ±
                'corn': 2,
                'carrot': 0,
                'bread': 0,
                'egg': 0
            },
            grid: [
                // 0: Ø¹Ø´Ø¨ØŒ 1: Ø£Ø±Ø¶ØŒ 2: Ù…Ø®Ø¨Ø²ØŒ 3: Ø¯Ø¬Ø§Ø¬
                {id:0, type:1, content:null}, {id:1, type:1, content:null}, {id:2, type:1, content:null},
                {id:3, type:0, content:null}, {id:4, type:0, content:null}, {id:5, type:0, content:null},
                // ... ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø´Ø¨ÙƒØ©
            ]
        };

        let currentTool = null; // 'scythe' or 'seed_wheat' ...

        // === 3. Ù†Ø¸Ø§Ù… TON ===
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-btn'
        });

        // === 4. Ø§Ù„Ù…Ù†Ø·Ù‚ (Logic) ===
        const Game = {
            init: function() {
                if(localStorage.getItem('HayDay_v1')) {
                    state = JSON.parse(localStorage.getItem('HayDay_v1'));
                }
                UI.renderGrid();
                UI.updateHeader();
                
                // Ø­Ù„Ù‚Ø© Ø§Ù„Ù†Ù…Ùˆ
                setInterval(() => {
                    let changed = false;
                    state.grid.forEach(tile => {
                        if(tile.content && tile.content.status === 'growing') {
                            const crop = CONFIG.crops[tile.content.type];
                            if(Date.now() - tile.content.startTime >= crop.time) {
                                tile.content.status = 'ready';
                                changed = true;
                            }
                        }
                    });
                    if(changed) UI.renderGrid();
                }, 1000);
            },

            save: function() {
                localStorage.setItem('HayDay_v1', JSON.stringify(state));
            },

            // Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶
            onTileClick: function(index) {
                const tile = state.grid[index];

                // 1. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø±Ø¶ ÙØ§Ø±ØºØ© ÙˆÙ„Ø¯ÙŠÙ†Ø§ Ø£Ø¯Ø§Ø© Ø²Ø±Ø§Ø¹Ø©
                if (tile.type === 1 && !tile.content && currentTool && currentTool.startsWith('seed_')) {
                    const cropType = currentTool.split('_')[1];
                    if (state.inventory[cropType] > 0) {
                        state.inventory[cropType]--;
                        tile.content = { type: cropType, status: 'growing', startTime: Date.now() };
                        UI.floatText(`-${1} ${CONFIG.crops[cropType].icon}`, index);
                        UI.playSound('plant');
                    } else {
                        tg.showAlert("Ù†ÙØ°Øª Ø§Ù„Ø¨Ø°ÙˆØ±! Ø§Ø´ØªØ±Ù Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø£Ùˆ Ø§Ø­ØµØ¯ Ø§Ù„Ù…Ø²ÙŠØ¯.");
                    }
                }
                
                // 2. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØµÙˆÙ„ Ø¬Ø§Ù‡Ø²Ø§Ù‹ ÙˆÙ„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ù…Ù†Ø¬Ù„ (Ø£Ùˆ Ø¨Ø§Ù„Ø¶ØºØ· ÙÙ‚Ø·)
                else if (tile.type === 1 && tile.content && tile.content.status === 'ready') {
                    const cropType = tile.content.type;
                    const cropData = CONFIG.crops[cropType];
                    
                    // Ø§Ù„Ø­ØµØ§Ø¯ ÙŠØ¹Ø·ÙŠÙƒ 2 (ÙˆØ§Ø­Ø¯Ø© ÙƒØ¨Ø°Ø±Ø© ÙˆÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¨ÙŠØ¹)
                    state.inventory[cropType] += 2; 
                    state.xp += cropData.xp;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                    if(state.xp >= state.maxXp) {
                        state.level++;
                        state.xp = 0;
                        state.maxXp *= 1.5;
                        tg.showAlert(`Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${state.level} ğŸ‰`);
                    }

                    tile.content = null;
                    UI.floatText(`+2 ${cropData.icon}`, index);
                    UI.floatText(`+${cropData.xp} XP`, index, 100);
                    UI.playSound('harvest');
                }

                Game.save();
                UI.renderGrid();
                UI.updateHeader();
            },

            buyPlot: function() {
                if(state.coins >= 50) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø¨Ù„Ø§Ø·Ø© Ø¹Ø´Ø¨ ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ø£Ø±Ø¶
                    const grassIndex = state.grid.findIndex(t => t.type === 0);
                    if(grassIndex !== -1) {
                        state.coins -= 50;
                        state.grid[grassIndex].type = 1; // ØªØ­ÙˆÙŠÙ„ Ù„Ø£Ø±Ø¶
                        Game.save();
                        UI.renderGrid();
                        UI.updateHeader();
                        tg.showAlert("ØªÙ… Ø´Ø±Ø§Ø¡ Ø£Ø±Ø¶ Ø¬Ø¯ÙŠØ¯Ø©!");
                    } else {
                        tg.showAlert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø§Ø­Ø© Ù„Ù„ØªÙˆØ³Ø¹ Ø­Ø§Ù„ÙŠØ§Ù‹!");
                    }
                } else {
                    tg.showAlert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø°Ù‡Ø¨ ÙƒØ§ÙÙ!");
                }
            },

            completeOrder: function(orderIndex) {
                // Ù…Ù†Ø·Ù‚ ÙˆÙ‡Ù…ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
                state.coins += 50;
                state.xp += 20;
                document.getElementById(`order-${orderIndex}`).remove();
                UI.updateHeader();
                UI.floatText("+50 ğŸ’°", 0); // ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
                tg.HapticFeedback.notificationOccurred('success');
                Game.save();
            }
        };

        // === 5. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI) ===
        const UI = {
            renderGrid: function() {
                const gridEl = document.getElementById('grid');
                gridEl.innerHTML = '';
                
                state.grid.forEach((tile, index) => {
                    const el = document.createElement('div');
                    el.className = `tile ${tile.type === 1 ? 'farmland' : ''}`;
                    el.onclick = () => Game.onTileClick(index);

                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØµÙˆÙ„
                    if (tile.content) {
                        const crop = CONFIG.crops[tile.content.type];
                        const sprite = document.createElement('div');
                        sprite.className = 'sprite';
                        sprite.innerText = crop.icon;
                        
                        if(tile.content.status === 'growing') {
                            el.classList.add('growing');
                        } else {
                            el.classList.add('ready');
                        }
                        el.appendChild(sprite);
                    }
                    
                    gridEl.appendChild(el);
                });
            },

            updateHeader: function() {
                document.getElementById('coins').innerText = Math.floor(state.coins);
                document.getElementById('gems').innerText = state.gems;
                document.getElementById('level').innerText = state.level;
                
                const pct = (state.xp / state.maxXp) * 100;
                document.getElementById('xp-bar').style.width = `${pct}%`;

                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                let seedsCount = 0;
                Object.keys(CONFIG.crops).forEach(k => seedsCount += state.inventory[k]);
                document.getElementById('silo-count').innerText = seedsCount;
            },

            openModal: function(id) {
                document.querySelectorAll('.modal-overlay').forEach(el => el.style.display = 'none');
                document.getElementById(`modal-${id}`).style.display = 'flex';
                
                if(id === 'silo') UI.renderSilo();
                if(id === 'barn') UI.renderBarn();
                if(id === 'orders') UI.renderOrders();
            },

            closeAll: function() {
                document.querySelectorAll('.modal-overlay').forEach(el => el.style.display = 'none');
            },

            renderSilo: function() {
                const container = document.getElementById('silo-grid');
                container.innerHTML = '';
                Object.keys(CONFIG.crops).forEach(key => {
                    const count = state.inventory[key];
                    if(count > 0) {
                        const div = document.createElement('div');
                        div.className = 'tool-btn';
                        div.style.width = '60px'; div.style.height = '60px';
                        div.innerHTML = `${CONFIG.crops[key].icon}<span class="badge">${count}</span>`;
                        div.onclick = () => {
                            UI.selectTool(`seed_${key}`, CONFIG.crops[key].name);
                            UI.closeAll();
                        };
                        container.appendChild(div);
                    }
                });
            },

            renderOrders: function() {
                const list = document.getElementById('orders-list');
                list.innerHTML = '';
                // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©
                const item = document.createElement('div');
                item.className = 'order-card';
                item.id = 'order-1';
                item.innerHTML = `
                    <div style="text-align:right">
                        <strong>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</strong><br>
                        <small>ØªØ­ØªØ§Ø¬: 3 ğŸŒ¾</small>
                    </div>
                    <div>
                        <div style="color:#E65100; font-weight:bold;">50 ğŸ’°</div>
                        <div style="color:#00E676; font-size:12px;">20 XP</div>
                    </div>
                    <button onclick="Game.completeOrder(1)" style="background:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:5px;">ØªÙˆØµÙŠÙ„</button>
                `;
                list.appendChild(item);
            },

            selectTool: function(toolId, name) {
                currentTool = toolId;
                const display = document.getElementById('current-tool-display');
                display.style.display = 'block';
                document.getElementById('tool-name').innerText = `Ø²Ø±Ø§Ø¹Ø© ${name}`;
                
                // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => {
                    currentTool = null;
                    display.style.display = 'none';
                }, 10000);
            },

            floatText: function(text, gridIndex, offset = 0) {
                // Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ ØªÙ‚Ø±ÙŠØ¨ÙŠ (Ù„ÙŠØ³ Ø¯Ù‚ÙŠÙ‚Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø¢ÙŠØ²ÙˆÙ…ØªØ±ÙŠ)
                const floater = document.createElement('div');
                floater.className = 'floater';
                floater.innerText = text;
                
                // Ù†Ø¶Ø¹ Ø§Ù„Ù†Øµ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„ØªØ³Ù‡ÙŠÙ„ØŒ Ø£Ùˆ ÙÙˆÙ‚ Ø§Ù„Ø´Ø¨ÙƒØ©
                const grid = document.getElementById('grid');
                floater.style.left = '50%';
                floater.style.top = '50%';
                
                document.body.appendChild(floater);
                setTimeout(() => floater.remove(), 1000);
            },

            playSound: function(type) {
                tg.HapticFeedback.impactOccurred(type === 'plant' ? 'light' : 'medium');
            }
        };

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
        Game.init();

    </script>
</body>
</html>
