<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø²Ø±Ø¹ØªÙŠ Ø§Ù„Ø³Ø¹ÙŠØ¯Ø©</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #87CEEB; /* Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ */
            --ground-color: #90EE90; /* Ù„ÙˆÙ† Ø§Ù„Ø£Ø±Ø¶ */
            --barn-bg: #FFF8DC;
            --text-color: #333;
            --accent-color: #e67e22;
        }
        body {
            background: linear-gradient(to bottom, var(--bg-color) 0%, var(--ground-color) 100%);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            user-select: none;
            overflow: hidden;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
        .header {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            font-size: 18px;
        }
        .resource-item { display: flex; align-items: center; }
        .resource-icon { margin-left: 8px; font-size: 24px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-stage {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background-image: url('https://cdn-icons-png.flaticon.com/512/2909/2909477.png'); /* Ø®Ù„ÙÙŠØ© Ø­Ø¸ÙŠØ±Ø© ÙƒØ±ØªÙˆÙ†ÙŠØ© */
            background-size: cover;
            background-position: center;
            margin: 20px;
            border-radius: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¨Ù‚Ø±Ø© */
        .cow-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø© */
        .cow-image {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
            transition: transform 0.1s ease-in-out;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¶ØºØ· (Ø§Ù„Ø¶Ø±Ø¹) */
        .udder-click-area {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 60px;
            background: rgba(255, 0, 0, 0.0); /* Ø´ÙØ§Ù Ù„Ù„ØªØ¬Ø±Ø¨Ø© */
            border-radius: 30%;
            cursor: pointer;
            z-index: 10;
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· */
        .cow-container:active .cow-image {
            transform: scale(0.97) translateY(5px);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ø·Ø§Ø¦Ø±Ø© */
        .floating-item {
            position: absolute;
            font-weight: bold;
            font-size: 28px;
            pointer-events: none;
            animation: floatUpMilk 1s ease-out forwards;
            z-index: 20;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        @keyframes floatUpMilk {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-120px) scale(1.5); }
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ (Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„) */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: #fff;
            padding: 10px;
            border-top: 2px solid #eee;
        }
        .nav-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            color: #888;
            font-size: 14px;
            border-radius: 10px;
        }
        .nav-btn.active { color: var(--accent-color); background: #fff3e0; font-weight: bold; }
        .nav-icon { display: block; font-size: 24px; margin-bottom: 5px; }

    </style>
</head>
<body>

    <div class="header">
        <div class="resource-item">
            <span class="resource-icon">ğŸ¥›</span>
            <span id="milkCount">0</span> Ù„ØªØ±
        </div>
        <div class="resource-item">
            <span class="resource-icon">ğŸ’°</span>
            <span id="moneyCount">0</span> Ø¯.Ø¬
        </div>
    </div>

    <div class="main-stage">
        <h2 style="position: absolute; top: 20px; color: #fff; text-shadow: 1px 1px 3px #000;">Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø£Ø¨Ù‚Ø§Ø±</h2>
        
        <div class="cow-container" id="cowContainer">
            <img src="https://cdn-icons-png.flaticon.com/512/2395/2395796.png" alt="Cow" class="cow-image">
            
            <div class="udder-click-area" onclick="milkCow(event)"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn active">
            <span class="nav-icon">ğŸ®</span>
            Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
        </div>
        <div class="nav-btn" style="opacity: 0.5;">
            <span class="nav-icon">ğŸŒ±</span>
            Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ù‚Ø±ÙŠØ¨Ø§Ù‹)
        </div>
        <div class="nav-btn" style="opacity: 0.5;">
            <span class="nav-icon">ğŸª</span>
            Ø§Ù„Ø³ÙˆÙ‚ (Ù‚Ø±ÙŠØ¨Ø§Ù‹)
        </div>
    </div>

    <script>
        // 1. ØªÙ‡ÙŠØ¦Ø© ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 2. ÙƒØ§Ø¦Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (State Object) - Ù‡Ù†Ø§ Ù†Ø­ÙØ¸ ÙƒÙ„ Ø´ÙŠØ¡
        let gameState = {
            milk: 0,        // ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ù„ÙŠØ¨
            money: 0,       // Ø§Ù„Ù…Ø§Ù„
            cowLevel: 1,    // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ù‚Ø±Ø© (ÙƒÙ… ØªÙ†ØªØ¬ ÙÙŠ Ø§Ù„Ø¶ØºØ·Ø©)
            // Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:
            // plots: [], // Ø§Ù„Ø­Ù‚ÙˆÙ„
        };

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const milkEl = document.getElementById('milkCount');
        const moneyEl = document.getElementById('moneyCount');
        const cowContainer = document.getElementById('cowContainer');

        // 3. ØªØ­Ù…ÙŠÙ„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function loadGame() {
            const saved = localStorage.getItem('farm_save_v1');
            if (saved) {
                // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø¹ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                gameState = { ...gameState, ...JSON.parse(saved) };
            }
            updateUI();
        }

        function saveGame() {
            localStorage.setItem('farm_save_v1', JSON.stringify(gameState));
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI() {
            milkEl.innerText = gameState.milk.toFixed(1); // Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø¹Ø´Ø±ÙŠ ÙˆØ§Ø­Ø¯
            moneyEl.innerText = gameState.money;
        }

        // 5. Ù…Ù†Ø·Ù‚ Ø­Ù„Ø¨ Ø§Ù„Ø¨Ù‚Ø±Ø©
        function milkCow(event) {
            // Ù…Ù†Ø¹ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø­Ø¯Ø« Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø¨ - Ù…Ù‡Ù… Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¶ØºØ·
            event.stopPropagation();

            // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ù„ÙŠØ¨ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ù‚Ø±Ø©
            let amount = gameState.cowLevel * 0.5; // Ù…Ø«Ù„Ø§Ù‹ Ù†ØµÙ Ù„ØªØ± ÙÙŠ Ø§Ù„Ø¶ØºØ·Ø©
            gameState.milk += amount;
            
            // Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ù‡Ø§ØªÙ
            tg.HapticFeedback.impactOccurred('light');
            
            // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ: Ù‚Ø·Ø±Ø§Øª Ø­Ù„ÙŠØ¨ ØªØ·ÙŠØ±
            showFloatingEffect(event.clientX, event.clientY, `+${amount}L ğŸ¥›`);
            
            saveGame();
            updateUI();

            // ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø¨Ù‚Ø±Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ (Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„Ù‡ Ù…Ø¹ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¶ØºØ·)
            cowContainer.style.transform = 'scale(0.98) translateY(5px)';
            setTimeout(() => {
                cowContainer.style.transform = 'scale(1) translateY(0)';
            }, 100);
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
        function showFloatingEffect(x, y, content) {
            const el = document.createElement('div');
            el.className = 'floating-item';
            el.innerText = content;
            // ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†ØµØ± ÙÙˆÙ‚ Ù…ÙƒØ§Ù† Ø§Ù„Ø¶ØºØ· ØªÙ…Ø§Ù…Ø§Ù‹
            el.style.left = `${x - 20}px`; 
            el.style.top = `${y - 50}px`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
        loadGame();

    </script>
</body>
</html>
